function _defineProperty(t,e,i){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}import React,{Component,createRef,createContext}from"react";import AIOInput from"aio-input";import AIOCanvas from"aio-canvas";import $ from"jquery";import"./index.css";import{jsx as _jsx}from"react/jsx-runtime";import{jsxs as _jsxs}from"react/jsx-runtime";var RChartContext=createContext();export default class RChart extends Component{constructor(t){super(t);let e=new AIOCanvas;this.mouseDownDetail={};var{filter:i,data:s}=this.props;this.state={Canvas:e,popup:!1,dataHide:{},filter:i,data:s,prevData:JSON.stringify(s)},this.dom=createRef(),this.details={min:1/0,max:-1/0},this.touch="ontouchstart"in document.documentElement,$("body").on("mouseout",".r-chart-canvas",()=>{$(".r-chart-popup-container").html(""),$(".r-chart-line").css({display:"none"})}),this.touch&&this.eventHandler("window","mouseup",()=>{$(".r-chart-popup-container").html(""),$(".r-chart-line").css({display:"none"})}),this.translate=this.props.translate?t=>this.props.translate(t):t=>t}value_getRange(t){var e,i,s,{min:a,max:r,axisToD:l}=this.details;let{Canvas:n}=this.state;var o=this.state.filter[l[t]],h=n.size[t];if(void 0===a||void 0===r)return!1;var d=r-a,u=1;if(0===d)a<0?(e=2*a,i=Math.abs(a),s=0):a>0?(e=0,i=a,s=2*a):(e=-1,i=1,s=1);else{for(;d/10>1;)u*=10,d/=10;e=Math.round(a/(i=d>=0&&d<=3?.2*u:u))*i-i,s=Math.round(r/i)*i+i}for(var p=(s-e)/i,c=h?Math.ceil(h/60):10;p>c;)i*=2,p=(s-e)/i;var[y=e,g=s]=o;y<e&&(y=e),g>s&&(g=s);var v={start:e,end:s,step:i,p1:y,p2:g};return{start:y,step:i,end:g,filter:v}}getGap(t){return Math.max(.5,Math.round(t/10))}key_getRange(t){var e,{axisToD:i}=this.details;let{Canvas:s}=this.state;var{keys:a}=this.props,r=this.state.filter[i[t]];e="x"===t?this.props.labelSize:30;let l=s.size[t];var n=r[0]?a.indexOf(r[0]):0,o=r[1]?a.indexOf(r[1]):a.length-1;-1===n&&(n=0),-1===o&&(o=a.length-1);var h={start:0,end:a.length-1,p1:n,p2:o},d=o-n+1,u=this.getGap(d),p=l/d,c=Math.floor(l/e),y=Math.floor(d/(c=c<1?1:c));return{start:n-u,step:y=y<1?1:y,end:o+u,count:d,filter:h,labelSpace:p}}normal_getArea(t,e,i="rgba(255,255,255,0)"){let{Canvas:s}=this.state,a;return(a={type:"Line",points:t.slice(),fill:[0,0,0,-s.size[this.details.dToAxis.value],["0 "+i,"1 "+e]]}).points.splice(0,0,[t[0][0],0]),a.points.push([t[t.length-1][0],0]),a}reverse_getArea(t,e,i){let{Canvas:s}=this.state,a={type:"Line",points:t.slice(),fill:[0,0,s.size[this.details.dToAxis.value],0,["0 rgba(255,255,255,0)","1 "+e]]};return a.points.splice(0,0,[0,t[0][1]]),a.points.push([0,t[t.length-1][1]]),a}value_getPercentByValue(t,e={}){var{start:i,end:s}=this.details.range[t];return 100*(e._value-i)/(s-i)}key_getPercentByValue(t,e={}){let{start:i,end:s}=this.details.range[t];return 100*(e._keyIndex-i)/(s-i)}value_changeFilter(t,e){let{filter:i}=this.state;i.value=[t,e],this.SetState({filter:i})}key_changeFilter(t,e){let{filter:i}=this.state,{keys:s}=this.props;i.key=[s[t],s[e]],this.SetState({filter:i})}getLimitTypeNumber(t){for(var e=1/0,i=-1/0,s=0;s<t.length;s++)for(var{points:a=[],getValue:r=t=>t.y}=t[s],l=0;l<a.length;l++){let n=r(a[l]);n<e&&(e=n),n>i&&(i=n)}return{min:e,max:i}}eventHandler(t,e,i,s="bind"){var a={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"};e="ontouchstart"in document.documentElement?a[e]:e;var r="string"==typeof t?"window"===t?$(window):$(t):t;r.unbind(e,i),"bind"===s&&r.bind(e,i)}getShapes(t,e){for(var i=[],s=0;s<t.length;s++){let a=t[s],r={...a};if(a.points){r.points=[];for(var l=0;l<a.points.length;l++){let{x:n,y:o}=a.points[l];r.points.push([e.getPercentByValue.x(n)+"%",-e.getPercentByValue.y(o)+"%"])}}else if(a.r){let{x:h,y:d}=a;r.x=e.getPercentByValue.x(h)+"%",r.y=-e.getPercentByValue.y(d)+"%"}i.push(r)}return i}getAxisSize(){let{keyAxis:t,valueAxis:e}=this.props,{size:i=40}=t,{size:s=50}=e;return[i,s]}getStyle(){let[t,e]=this.getAxisSize();return{gridTemplateColumns:`${e}px auto`,gridTemplateRows:`auto ${t}px`,direction:"ltr"}}getClient(t){return this.touch?{x:t.changedTouches[0].clientX,y:t.changedTouches[0].clientY}:{x:t.clientX,y:t.clientY}}SetState(t){this.setState(t)}setPointDetails(t,e,i,s){let{keyAxis:a,valueAxis:r,precision:l}=this.props,{edit:n=t=>t}=a,{edit:o=t=>t}=r,{getKey:h=t=>t.x,getValue:d=t=>t.y,pointText:u,pointTextStyle:p}=t;if(i._key=h(i),i._value=d(i),isNaN(i._value)||"string"!=typeof i._key||(i._keyIndex=this.details.keysDictionary[i._key],void 0===i._keyIndex))return!1;i._px=this.getPercentByValue("x",i),i._py=this.getPercentByValue("y",i),i._dataIndex=e,i._pointIndex=s,i._label={key:n(i._key),value:o(i._value.toFixed(l))},this.keyDictionary[e][i._key]={...i};let c=this.getValueByField(i,u);if(c){let{fontSize:y=16,color:g="#444",left:v=0,top:m=0,rotate:$,align:x}=this.getValueByField(i,p)||{};this.elements.texts.push({type:"Group",x:i._px+"%",y:i._py+"%",rotate:$,items:[{type:"Text",text:c,fontSize:y,fill:g,x:v,y:m,align:x}]})}}getValueByField(point,field){let props=this.props;try{let type=typeof field;if("function"===type)return field(point);if("string"===type&&-1!==field.indexOf(".")&&(-1!==field.indexOf("point")||-1!==field.indexOf("props"))){let result;return eval("result = "+field),result}return field}catch{return}}addCanvasPoint(t,e,i,s){let{hideInterfere:a}=this.props,{Canvas:r}=this.state,{color:l="#000",lineWidth:n=1,pointRadius:o,pointStroke:h,pointFill:d,pointStrokeWidth:u,pointDash:p,lineDash:c,pointSlice:y}=t,g=this.getValueByField(i,o),v=this.getValueByField(i,h)||l,m=this.getValueByField(i,d)||"#fff",$=this.getValueByField(i,u)||n,x=this.getValueByField(i,p),f=this.getValueByField(i,y);if(!g)return;let _=-1/0;if(a){let D=r.size.x*i._px/100;if(!(D-g-$/2>_))return;_=D+g+$/2}this.elements.points.push({type:"Group",x:i._px+"%",y:i._py+"%",dataIndex:e,pointIndex:s,items:[{type:"Arc",r:this.props.clickRadius,fill:"rgba(0,0,0,0)",onMouseDown:this.pointMouseDown.bind(this),dataIndex:e,pointIndex:s},{type:"Arc",r:g,lineWidth:2*$,fill:m,stroke:v,dash:x,slice:f}]})}addCanvasRect(t,e,i,s,a){let{color:r}=t,{reverse:l}=this.props,{barCount:n,barWidth:o}=this.details,h={type:"Rectangle",dataIndex:e,pointIndex:s,onMouseDown:this.pointMouseDown.bind(this),fill:r},d=o*(n/2-a)+"%";h=l?{...h,width:i._px+"%",height:o+"%",y:i._py+"%",pivot:[0,d]}:{...h,width:o+"%",height:i._py+"%",x:i._px+"%",pivot:[d,0]},this.elements.rects.push(h)}getLineChart(t,e){let{color:i="#000",lineWidth:s=1,lineDash:a,areaColor:r}=t,l={type:"Line",points:[],lineWidth:s,stroke:i,dash:a};for(let n=0;n<t.points.length;n++){let o=t.points[n];!1!==this.setPointDetails(t,e,o,n)&&(l.points.push([o._px+"%",o._py+"%"]),this.addCanvasPoint(t,e,o,n))}s&&this.elements.lines.push(l),r&&l.points.length&&this.elements.areas.push(this.getArea(l.points,i,r))}getBarChart(t,e,i){for(var s=0;s<t.points.length;s++){let a=t.points[s];!1!==this.setPointDetails(t,e,a,s)&&this.addCanvasRect(t,e,a,s,i)}}getGridLines(t){var e=this.props[this.details.axisToD[t]+"Axis"].gridColor,{keys:i}=this.props;if(!e)return[];var s=this.details.range[t];if(!s)return[];var{start:a,step:r,end:l}=s,n=Math.round((a-r)/r)*r,o=[];if("key"===this.details.axisToD[t])for(;n<=l;)n>=a&&i[n]&&o.push(this.getLine({color:e,key:i[n]})),n+=r;else for(;n<=l;)n>=a&&o.push(this.getLine({color:e,value:n})),n+=r;return o}getLine({dash:t,lineWidth:e,color:i="red",key:s=[!1,!1],value:a=[!1,!1]}){var r=this.details.dToAxis.key,l=this.details.dToAxis.value;Array.isArray(s)||(s=[s,s]),Array.isArray(a)||(a=[a,a]);let[n,o]=s,[h,d]=a,u=!1===n?0:this.getPercentByValue(r,{_keyIndex:this.details.keysDictionary[n]}),p=!1===o?100:this.getPercentByValue(r,{_keyIndex:this.details.keysDictionary[o]}),c=!1===h?0:this.getPercentByValue(l,{_value:h}),y=!1===d?100:this.getPercentByValue(l,{_value:d}),g="x"===r?[[u+"%",c+"%"],[p+"%",y+"%"]]:[[c+"%",u+"%"],[y+"%",p+"%"]];return{stroke:i,lineWidth:e,points:g,type:"Line",dash:t}}getElements(){var{lines:t=[]}=this.props,{data:e,dataHide:i}=this.state;this.keyDictionary=e.map(()=>({})),this.elements={xGridLines:this.getGridLines("x"),yGridLines:this.getGridLines("y"),areas:[],rects:[],lines:[],points:[],texts:[],shapes:[],indicators:t.map(t=>this.getLine(t))};for(var s=0,a=0;a<e.length;a++){let{points:r,title:l,type:n="line",shapes:o=()=>[]}=e[a];(!l||!i[l])&&r&&Array.isArray(r)&&0!==r.length&&("line"===n?this.getLineChart(e[a],a):"bar"===n&&(this.getBarChart(e[a],a,s),s++),this.elements.shapes=this.getShapes(o(),this.details))}var h=[];for(var d in this.elements)h=h.concat(this.elements[d]);return this.lastData=e,h}componentDidMount(){this.SetState({})}getDetails(){let{data:t}=this.state;var{keyAxis:e,valueAxis:i,barWidth:s=80,reverse:a,keys:r}=this.props,l=this.details;if(!l.axisToD){let{zoom:n}=e,{zoom:o}=i;a?(l.axisToD={x:"value",y:"key"},l.dToAxis={key:"y",value:"x"},this.getArea=this.reverse_getArea,n&&(l.yZoom=!0),o&&(l.xZoom=!0)):(l.axisToD={x:"key",y:"value"},l.dToAxis={key:"x",value:"y"},this.getArea=this.normal_getArea,n&&(l.xZoom=!0),o&&(l.yZoom=!0)),this.changeFilter=(t,e,i)=>this[l.axisToD[t]+"_changeFilter"](e,i),this.getRange=t=>this[l.axisToD[t]+"_getRange"](t),this.getPercentByValue=(t,e)=>this[l.axisToD[t]+"_getPercentByValue"](t,e)}if("point"!==this.mouseDownDetail.target){if("filter"!==this.mouseDownDetail.target){var h=this.getLimitTypeNumber(t);this.details.min=h.min,this.details.max=h.max,l.keysDictionary={};for(let d=0;d<r.length;d++)l.keysDictionary[r[d]]=d}this.details.range={x:this.getRange("x"),y:this.getRange("y")},this.details.labelSpace=this.details.range[l.dToAxis.key].labelSpace}l.barCount=t.filter(t=>"bar"===t.type).length,l.barWidth=s/l.range[l.dToAxis.key].count/l.barCount}pointMouseDown(t,e,i){var{dataIndex:s,pointIndex:a}=i;let{data:r}=this.state,{onChange:l,onRemove:n}=this.props;if(l&&!1!==r[s].editable){this.getMouseDetail(e);var o=r[s].points[a];this.mouseDownDetail={target:"point",key:o._key,value:o._value},l&&!1!==r[s].draggable&&this.eventHandler("window","mousemove",$.proxy(this.pointMouseMove,this)),(l||n)&&this.eventHandler("window","mouseup",$.proxy(this.pointMouseUp,this)),this.so={dataIndex:s,pointIndex:a,x:this.mouseDetail.x,y:this.mouseDetail.y},this.moved=!1}}pointMouseMove(){let{data:t}=this.state,{onChange:e}=this.props,i=t[this.so.dataIndex].points[this.so.pointIndex];var{dToAxis:s}=this.details;!(!this.moved&&(8>Math.abs(this.mouseDetail[s.value]-this.so[s.value])||i._value===this.mouseDetail.value))&&(this.moved=!0,e({point:i,key:i._key,value:this.mouseDetail.value,dataIndex:this.so.dataIndex,pointIndex:this.so.pointIndex,drag:!0}))}pointMouseUp(){this.eventHandler("window","mousemove",this.pointMouseMove,"unbind"),this.eventHandler("window","mouseup",this.pointMouseUp,"unbind"),this.mouseDownDetail={};var{data:t,onRemove:e,onChange:i}=this.props,s=t[this.so.dataIndex].points[this.so.pointIndex];if(!this.moved){var a=i?this.translate("Edit Point"):this.translate("Remove Point");this.SetState({popup:{disabled:e&&!i,dataIndex:this.so.dataIndex,pointIndex:this.so.pointIndex,dataIndexes:[this.so.dataIndex],dynamicValue:s._value,staticValue:this.mouseDetail.key,onEdit:i,onRemove:e,title:a}});return}var r={point:s,key:s._key,value:this.mouseDetail.value,dataIndex:this.so.dataIndex,pointIndex:this.so.pointIndex};i&&i(r)}mouseDown(t,e){if("ontouchstart"in document.documentElement){this.eventHandler("window","mouseup",$.proxy(this.addMouseUp,this)),this.getMouseDetail(e);return}var{onAdd:i,multiselect:s}=this.props;this.mouseDownKey=this.mouseDetail.key,i&&this.mouseDetail.addDataIndexes.length&&this.eventHandler("window","mouseup",$.proxy(this.addMouseUp,this));var{reverse:a}=this.props;s&&"point"!==this.mouseDetail.target&&(this.multiselect={},this.multiselect.selectRect=$(this.dom.current).find(".r-chart-multiselect"),a?(this.multiselect.selectRect.css({display:"block",top:this.mouseDetail.py+"%",height:"0%",width:"100%",left:0}),this.multiselect.position=this.mouseDetail.py):(this.multiselect.selectRect.css({display:"block",left:this.mouseDetail.px+"%",width:"0%",height:"100%",top:0}),this.multiselect.position=this.mouseDetail.px),this.eventHandler("window","mousemove",$.proxy(this.multiselectMove,this)),this.eventHandler("window","mouseup",$.proxy(this.multiselectUp,this)))}addMouseUp(){var{onAdd:t,addPopup:e}=this.props;if(this.eventHandler("window","mouseup",this.addMouseUp,"unbind"),this.touch){if(0===this.mouseDetail.addDataIndexes.length)return}else if(this.mouseDetail.key!==this.mouseDownKey)return;!1===e?t(this.mouseDetail):this.SetState({popup:{type:"add",dataIndexes:this.mouseDetail.addDataIndexes,dataIndex:this.mouseDetail.addDataIndexes[0],dynamicValue:this.mouseDetail.value,staticValue:this.mouseDetail.key,onAdd:t,title:this.translate("Add Point")}})}multiselectMove(){var{reverse:t}=this.props,e=this.multiselect;if(this.mouseDetail.key!==this.mouseDownKey){if(t){var i=this.mouseDetail.py;i<e.position?(e.end=e.position,e.start=i):(e.start=e.position,e.end=i);var s={height:e.end-e.start+"%",top:e.start+100+"%"};e.selectRect.css(s)}else{var i=this.mouseDetail.px;i<e.position?(e.end=e.position,e.start=i):(e.start=e.position,e.end=i),e.selectRect.css({width:e.end-e.start+"%",left:e.start+"%"})}}}hideSelectRect(){this.multiselect&&this.multiselect.selectRect&&this.multiselect.selectRect.css({display:"none"})}multiselectUp(){if(this.eventHandler("window","mousemove",this.multiselectMove,"unbind"),this.eventHandler("window","mouseup",this.multiselectUp,"unbind"),!this.multiselect.start||!this.multiselect.end||3>Math.abs(this.multiselect.start-this.multiselect.end)){this.hideSelectRect();return}var t=this.getPointsBySelectRect();0!==t.length&&this.props.multiselect(t),this.hideSelectRect()}getPointsBySelectRect(){var{data:t}=this.state,{start:e,end:i}=this.multiselect,s=[];for(let a=0;a<this.elements.points.length;a++){let r=this.elements.points[a],{dataIndex:l,pointIndex:n}=r;if(!1===t[l].editable)continue;let o=parseFloat(r[this.details.dToAxis.key]);!(o<e)&&!(o>i)&&s.push([l,n])}for(let h=0;h<this.elements.rects.length;h++){let d=this.elements.rects[h],{dataIndex:u,pointIndex:p}=d;if(!1===t[u].editable)continue;let c=parseFloat(d[this.details.dToAxis.key]);!(c<e)&&!(c>i)&&s.push([u,p])}return s}closePopup(){this.SetState({popup:!1}),this.hideSelectRect()}getPopup(t){return _jsx(RChartEdit,{...t,onChange:e=>{for(let i in e)t[i]=e[i];this.SetState({popup:t})},onClose:this.closePopup.bind(this)})}getHeader(){var{data:t,dataHide:e}=this.state;let[i,s]=this.getAxisSize();return _jsx("div",{className:"r-chart-title",style:{paddingLeft:s+"px"},children:t.filter(t=>void 0!==t.title).map((t,i)=>{let{color:s,title:a}=t;return _jsxs("div",{className:"r-chart-title-item",onClick:()=>{e[a]=void 0!==e[a]&&e[a],e[a]=!e[a],this.SetState({dataHide:e})},children:[_jsx("div",{className:"r-chart-title-color",style:e[t.title]?{boxShadow:`inset 0 0 0 2px ${s}`}:{background:s}}),_jsx("div",{className:"r-chart-title-text",children:t.title||"untitle"})]},i)})})}getLabelSlider(t){var{range:e,xZoom:i,yZoom:s,axisToD:a}=this.details;if(!e||!e[t])return null;var{start:r,end:l,step:n,labelSpace:o}=this.details.range[t],h=a[t];let{edit:d=t=>t}=this.props[h+"Axis"];"key"===h&&(this.transition=Math.min(o/100,.3));var u={x:{top:i?"24px":"14px"},y:{left:"unset",right:s?"16px":"8px",justifyContent:"flex-end"}},{labelRotate:p,keys:c}=this.props,y=a[t];return _jsx(AIOInput,{type:"slider",showValue:!1,className:"labelSlider",style:{position:"absolute",left:0,top:0,width:"100%",height:"100%",padding:0},pointStyle:()=>({display:"none"}),lineStyle:()=>({display:"none"}),direction:"x"===t?"right":"top",start:r,end:l,labelStep:n,fillStyle:{opacity:0},labelStyle:()=>({fontSize:"inherit",...u[t]}),labelRotate:()=>"y"===t?0:p,editLabel:t=>d("key"===y?c[t]||"":t)})}filterMouseDown(t){t.preventDefault(),this.mouseDownDetail.target="filter",$(this.dom.current).find(".r-chart-filterSlider-button").addClass("active"),this.eventHandler("window","mouseup",$.proxy(this.filterMouseUp,this))}filterMouseUp(){this.mouseDownDetail={},$(this.dom.current).find(".r-chart-filterSlider-button").removeClass("active"),this.eventHandler("window","mouseup",this.filterMouseUp,"unbind")}getFilterSlider(t){var{axisToD:e}=this.details,{zoomColor:i="#ddd"}=this.props,s=e[t];let a=this.props[s+"Axis"],{edit:r=t=>t}=a;var{zoom:l}=a;if(!l)return null;var{range:n}=this.details;if(!n||!n[t])return null;var{keys:o}=this.props,{p1:h,p2:d,start:u,end:p}=n[t].filter;return _jsx(AIOInput,{type:"slider",direction:"x"===t?"right":"top",start:u,end:p,multiple:!0,className:"filterSlider",style:{position:"absolute",...{x:{width:"100%",height:"16px",padding:"0 12px",top:"2px",opacity:1},y:{width:"16px",height:"100%",padding:"12px 0",right:"0px",opacity:1}}[t]},value:[h,d],getPointHTML:()=>_jsx("div",{className:"r-chart-filterSlider-button r-chart-filterSlider-button-"+t,onTouchStart:this.filterMouseDown.bind(this),onMouseDown:this.filterMouseDown.bind(this),style:{background:i,border:`1px solid ${i}`}}),fillStyle(e,s){if(0!==e)return{["y"===t?"width":"height"]:"1px",background:i}},editValue:t=>r("key"===s?o[t]:t),onChange:e=>this.changeFilter(t,e[0],e[1]),lineStyle:()=>({display:"none"}),pointStyle:()=>({display:"flex",alignItems:"center",justifyContent:"center",width:"30px",height:"30px",borderRadius:"0px",background:"none"})})}getAddableDataIndexes(t){if(void 0===t)return[];for(var{data:e}=this.state,i=[],s=0;s<e.length;s++){var{editable:a}=e[s];!1!==a&&void 0===this.keyDictionary[s][t]&&i.push(s)}return i}getNearestPointToMouse({key:t,value:e}){for(var{data:i}=this.state,s=!1,a=1/0,r=0;r<i.length;r++){let l=this.keyDictionary[r][t];if(void 0===l)continue;let n=l._pointIndex,o=i[r].points[n],h=Math.abs(o._value-e);h<=a&&(s={...o,...l},a=h)}return s}getMouseDetail(t){if(!t)return;let{keyAxis:e,valueAxis:i}=this.props,{Canvas:s}=this.state,{edit:a=t=>t}=e,{edit:r=t=>t}=i,{x:l,y:n,px:o,py:h}=t,d=s.canvasToClient([l,n]),u=d[0]+this.getAxisSize()[1],p=d[1],{onAdd:c}=this.props,{key:y="",keyIndex:g,value:v}=this.getValueByPercent({x:o,y:h}),m={key:""!==y?a(y):"",value:r(v)};m[this.details.dToAxis.key]=m.key,m[this.details.dToAxis.value]=m.value,"point"===this.mouseDownDetail.target&&(y=this.mouseDownDetail.key),this.mouseDetail={x:l,y:n,px:o,py:h,cx:u,cy:p,key:y,value:v,keyIndex:g,nearestPoint:this.getNearestPointToMouse({key:y,value:v}),addDataIndexes:c&&"point"!==this.mouseDownDetail.target?this.getAddableDataIndexes(y):[],label:m}}getValueByPercent(t){var{range:e,dToAxis:i}=this.details,s={keyIndex:-1,key:"",value:""},a=i.key,r=i.value;if(e[a]){let{keys:l}=this.props,{start:n,end:o}=e[a];s.keyIndex=Math.round((o-n)*t[a]/100+n),s.key=l[s.keyIndex]}if(e[r]){let{precision:h}=this.props,{start:d,end:u}=e[r];s.value=parseFloat(((u-d)*t[r]/100+d).toFixed(h))}return s}renderMouseLabels(t){var{cx:e,cy:i,label:s,addDataIndexes:a}=this.mouseDetail,r=t.find(".r-chart-horizontal-line"),l=t.find(".r-chart-vertical-line");if(r.css({display:"block",top:i+"px"}),l.css({display:"flex",left:e+"px"}),r.html(`<div style="padding-right:${this.details.yZoom?"16":"8"}px;">${s.y}</div>`),l.html(`<div style="top:calc(100% + ${this.details.xZoom?"14":"4"}px);">${s.x}</div>`),a.length){var{data:n}=this.props,o=t.find(".r-chart-add-popup"),h=`<div class="add-indicator" style="background:${n[a[0]].color}">+</div>`;o.css({left:e,top:i-(this.touch?40:0)}),o.html(`<div class="r-chart-popup">${h}${s.x} ${s.y}</div>`)}}renderPointLabels(t){var{nearestPoint:e}=this.mouseDetail;if(e){var i=t.find(".r-chart-detail-popup");i.css({left:`${e._px}%`,top:"unset",bottom:`${e._py}%`,transition:("point"===this.mouseDownDetail.target?0:this.transition)+"s"}),i.html('<div class="r-chart-popup">'+e._label.key+"  "+e._label.value+"</div>")}}render(){let{mouseDetail:t={}}=this;if("point"!==t.target){let e=JSON.stringify(this.props.data);e!==this.state.prevData&&setTimeout(()=>this.setState({data:this.props.data,prevData:e}),0)}if(this.props.data)var i="",s="",a="",r="",l="",n="";var{keys:o,html:h=()=>"",onAdd:d,id:u,className:p}=this.props,c="function"==typeof this.props.style?this.props.style():this.props.style,{popup:y,data:g,Canvas:v}=this.state,m=!1;if(g.length&&o){m=!0,this.getDetails();var x=this.details;l=this.getElements(),s=this.getLabelSlider("y"),r=this.getFilterSlider("y"),i=this.getLabelSlider("x"),a=this.getFilterSlider("x"),n=h(this.elements,x)}let f=this.getAxisSize();return _jsx(RChartContext.Provider,{value:{...this.props,translate:this.translate.bind(this)},children:_jsxs("div",{className:"r-chart"+(p?" "+p:""),ref:this.dom,style:c,id:u,children:[this.getHeader(),_jsxs("div",{className:"r-chart-container",style:this.getStyle(),children:[_jsx(RChartLine,{dir:"horizontal",axisSize:f}),_jsx(RChartLine,{dir:"vertical",axisSize:f}),d&&_jsx("div",{className:"r-chart-popup-container r-chart-add-popup"}),!1!==y&&this.getPopup(y),_jsxs("div",{className:"r-chart-axis r-chart-axis-y",children:[s," ",r]}),_jsxs("div",{className:"r-chart-canvas",children:[n,_jsx("div",{className:"r-chart-multiselect"}),v.render({screenPosition:["50%","50%"],items:l,events:{onMouseMove:(t,e)=>{if(m){this.getMouseDetail(e);var i=$(this.dom.current);i.find(".r-chart-popup-container").html(""),this.renderMouseLabels(i),this.renderPointLabels(i)}},onMouseDown:this.mouseDown.bind(this)}}),_jsx("div",{className:"r-chart-popup-container r-chart-detail-popup"})]}),_jsx("div",{className:"r-chart-corner"}),_jsxs("div",{className:"r-chart-axis r-chart-axis-x",children:[i," ",a]})]})]})})}};RChart.defaultProps={data:[],filter:{key:[],value:[]},precision:0,clickRadius:12,lines:[],labelSize:30,axisStyle:{},keyAxis:{},valueAxis:{}};class RChartLine extends Component{render(){let{dir:t,axisSize:e}=this.props,i="horizontal"===t?{width:`calc(100% - ${e[1]}px)`}:{height:`calc(100% - ${e[0]}px)`};return _jsx("div",{className:`r-chart-${t}-line r-chart-line`,style:i})}}class RChartEdit extends Component{constructor(t){super(t),this.dom=createRef()}componentDidMount(){$(this.dom.current).find("input").eq(0).focus().select()}render(){var{title:t,onChange:e,onClose:i,onAdd:s,onEdit:a,onRemove:r,dataIndex:l,pointIndex:n,dynamicValue:o,staticValue:h,dataIndexes:d=[],disabled:u}=this.props,{keyAxis:p,valueAxis:c,keys:y,data:g,translate:v,rtl:m}=this.context;let{title:x="untitle"}=p,{title:f="untitle"}=c;return _jsxs("div",{className:"r-chart-edit",ref:this.dom,style:{direction:m?"rtl":"ltr"},children:[_jsx("div",{className:"r-chart-edit-backdrop",onClick:i}),_jsxs("div",{className:"r-chart-edit-header",children:[_jsx("div",{className:"r-chart-edit-title",children:t}),_jsx("div",{className:"r-chart-edit-close",onClick:i})]}),_jsxs("div",{className:"r-chart-edit-body",children:[_jsx("div",{className:"r-chart-edit-data-list",children:d.map(t=>!1!==g[t].editable&&_jsx("div",{onClick:()=>e({dataIndex:t}),className:`r-chart-edit-data-list-item${l===t?" active":""}`,style:{color:g[t].color,background:g[t].color}},t)).filter(t=>!1!==t)}),void 0!==h&&_jsxs("div",{className:"r-chart-edit-item",children:[_jsx("div",{className:"r-chart-edit-label",title:x,children:x+" : "}),_jsx("div",{className:"r-chart-detail-value",children:h})]}),void 0!==o&&_jsxs("div",{className:"r-chart-edit-item",children:[_jsx("div",{className:"r-chart-edit-label",title:f,children:f+" : "}),_jsx("input",{disabled:u,className:"r-chart-edit-tag",type:"number",value:o,onChange(t){(a||s)&&e({dynamicValue:parseFloat(t.target.value)})}})]})]}),_jsxs("div",{className:"r-chart-edit-footer",children:[s&&_jsx("button",{className:"r-chart-edit-button",onClick(){let t=g[l].points,e=y.indexOf(h),a=t.length;for(let r=0;r<t.length;r++)if(t[r]._keyIndex>e){a=r;break}s({key:h,value:o,dataIndex:l,pointIndex:a}),i()},children:v("Add")}),r&&_jsx("button",{className:"r-chart-edit-button",onClick(){let t=g[l].points[n];r({point:t,key:t._key,value:t._value,dataIndex:l,pointIndex:n}),i()},children:v("Remove")}),a&&_jsx("button",{className:"r-chart-edit-button",onClick(){let t=g[l].points[n];a({point:t,key:t._key,value:o,dataIndex:l,pointIndex:n}),i()},children:v("Edit")})]})]})}}_defineProperty(RChartEdit,"contextType",RChartContext);export function getFakeData(t=100,e=100){for(var i=[],s=[],a=0;a<t;a+=1)e+=Math.round(10*Math.random()-5),i.push({x:a.toString(),y:e}),s.push(a.toString());return{points:i,keys:s}}export class Gauge extends Component{constructor(t){super(t),this.state={Canvas:new AIOCanvas},this.getDetails()}getPercentByValue(t,e,i){return 100*(t-e)/(i-e)}getDetails(){var{angle:t,start:e,end:i,direction:s}=this.props;this.scales=this.getScales(),this.labels=this.getLabels(),this.slice="clock"===s?[this.getAngleByValue(i),this.getAngleByValue(e)]:[this.getAngleByValue(e),this.getAngleByValue(i)],this.circles=this.getCircles()}getAngleByValue(t){var{direction:e,start:i,end:s,angle:a,rotate:r}=this.props,l=a/100*this.getPercentByValue(t,i,s);return"clock"===e?90+a/2-l+r:90-a/2+l+r}getRanges(){var{direction:t,ranges:e=[],radius:i,thickness:s}=this.props;if(!s)return[];for(var a=("function"==typeof e?e(this.props):e).map((t,e)=>{let{value:i,color:s,lineCap:a}=t;return i=parseFloat(i),isNaN(i)&&console.error(`r-gauger error: ranges[${e}].value is undefined or not an number`),{color:s,angle:this.getAngleByValue(i),lineCap:a}}),r=[],l=0;l<a.length;l++){var n,{color:o,angle:h,lineCap:d}=a[l],u=0===l?this.getAngleByValue(this.props.start):a[l-1].angle,p=h;n="clock"===t?[p,u]:[u,p],r.push({type:"Arc",lineCap:d,r:i,slice:n,stroke:o,lineWidth:s})}return r.reverse()}getCircles(){var{circles:t}=this.props;return t&&0!==t.length?t.map(t=>({type:"Arc",r:t.radius,lineWidth:t.lineWidth,stroke:t.stroke,fill:t.fill,lineCap:t.lineCap,slice:t.slice?this.slice:void 0})):[]}getLabels(){var{start:t,end:e,label:i,radius:s,thickness:a,angle:r}=this.props;if(!i||(Array.isArray(i)||(i=[i]),!i.length))return[];var l={};for(let n=0;n<i.length;n++){if(!i[n].step)continue;let{step:o,edit:h,min:d,max:u}=i[n];"number"!=typeof d&&(d=t),"number"!=typeof u&&(u=e),o=this.getValueByField(o),d=this.getValueByField(d),u=this.getValueByField(u),d<t&&(d=t),d>e&&(d=e),u<t&&(u=t),u>e&&(u=e);let p=void 0===i[n].start?Math.round(d/o)*o:i[n].start;for(;p<=u;){let{offset:c=0,color:y="#000",fontSize:g=10}=i[n];c=this.getValueByField(c,p),y=this.getValueByField(y,p),g=this.getValueByField(g,p);let v=c?-c:-(s-a/2);if(!l[p]){let m=this.getAngleByValue(p);l[p]={rotate:m,pivot:[v,0],type:"Group",items:[{type:"Text",text:h?h(p):p,fill:y,stroke:"transparent",rotate:-m,fontSize:g}]}}p+=o}}let $=[];for(let x in l)$.push(l[x]);return 360===r&&$[$.length-1].rotate%90==0&&$.pop(),$}getScales(){var{start:t,end:e,scale:i,radius:s,thickness:a}=this.props;Array.isArray(i)||(i=[i]);let r={};for(let l=0;l<i.length;l++){if(!i[l].step)continue;let{step:n,min:o,max:h}=i[l];"number"!=typeof o&&(o=t),"number"!=typeof h&&(h=e),n=this.getValueByField(n),o=this.getValueByField(o),h=this.getValueByField(h),o<t&&(o=t),o>e&&(o=e),h<t&&(h=t),h>e&&(h=e);let d=void 0===i[l].start?Math.round(o/n)*n:i[l].start;for(;d<=h;){let{offset:u=0,color:p="#000",width:c,height:y=5,lineCap:g}=i[l];u=this.getValueByField(u,d),p=this.getValueByField(p,d),c=this.getValueByField(c,d),y=this.getValueByField(y,d),g=this.getValueByField(g);let v=u?-u:-(s-y-a/2);if(!r[d]){let m=this.getAngleByValue(d);r[d]={type:"Line",stroke:p,lineCap:g,points:[[0,0],[y,0]],lineWidth:c,pivot:[v,0],rotate:m}}d+=n}}let $=[];for(let x in r)$.push(r[x]);return $}getHandles(){var{handle:t}=this.props;return t?Array.isArray(t)?t.map(t=>this.getHandle(t)):[this.getHandle(t)]:[]}getHandle(t){var{start:e,end:i,radius:s,thickness:a}=this.props,{value:r=!1,offset:l=0,color:n="#000",width:o=4,height:h=s-a/2,radius:d=4}=t;return l=this.getValueByField(l,r),n=this.getValueByField(n,r),o=this.getValueByField(o,r),h=this.getValueByField(h,r),d=this.getValueByField(d,r),{type:"Group",items:[{type:"Line",fill:n,points:[[0,-o/2],[h,0],[0,o/2]],lineWidth:0,pivot:[-l,0],rotate:this.getAngleByValue(r),close:!0,stroke:"transparent"},{type:"Arc",r:d,fill:n,stroke:"transparent"}]}}getTexts(){var{text:t}=this.props;return t?Array.isArray(t)?t.map(t=>this.getText(t)):[this.getText(t)]:[]}getValueByField(field,value){let props=this.props;try{let type=typeof field;if("function"===type)return field(props);if("string"===type&&(0===field.indexOf("props.")||0===field.indexOf("value"))){let result;return eval("result = "+field),result}return field}catch{return}}getText(t){var{value:e,top:i=20,left:s=0,fontSize:a=10,fontFamily:r="arial",color:l="#000",rotate:n=0}=t;e=this.getValueByField(e),i=this.getValueByField(i),s=this.getValueByField(s),a=this.getValueByField(a),r=this.getValueByField(r),Array.isArray(l=this.getValueByField(l))||(l=[l]);let[o,h]=l;return n=this.getValueByField(n),{type:"Text",text:"function"==typeof e?e(this.props):e,x:s,y:-i,rotate:n,fontSize:a,fontFamily:r,fill:o,stroke:h}}getItems(){return this.props.customShapes.concat(this.circles,this.getRanges(),this.labels,this.scales,this.getTexts(),this.getHandles())}getStyle(){var t={...this.props.style};return t.width=t.width,t.height=t.height,t}render(){var{dynamic:t,position:e,id:i,className:s}=this.props;let{Canvas:a}=this.state;return t&&this.getDetails(),a.render({className:`r-gauger${s?" "+s:""}`,id:i,items:this.getItems(),style:this.getStyle(),screenPosition:e})}}Gauge.defaultProps={angle:180,rotate:0,start:0,end:100,thickness:10,radius:70,scale:{},direction:"clock",position:[0,0],customShapes:[]};